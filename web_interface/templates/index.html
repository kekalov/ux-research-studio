<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ UX Research Studio - AI Agent Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            max-width: 80%;
        }

        .message.agent {
            background: #e3f2fd;
            margin-left: 0;
        }

        .message.user {
            background: #f3e5f5;
            margin-left: auto;
        }

        .message.progress {
            background: #fff3e0;
        }

        .message.success {
            background: #e8f5e8;
        }

        .message.error {
            background: #ffebee;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1e5e9;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .results-section {
            grid-column: 1 / -1;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .problems-list, .recommendations-list {
            list-style: none;
        }

        .problems-list li, .recommendations-list li {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .problems-list li {
            background: #fff3e0;
        }

        .recommendations-list li {
            background: #e8f5e8;
        }

        .personas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .persona-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e1e5e9;
        }

        .persona-rating {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .competitive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .competitor-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .competitor-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .competitor-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .advantages, .disadvantages {
            margin: 10px 0;
        }

        .advantages h4 {
            color: #28a745;
            margin-bottom: 5px;
        }

        .disadvantages h4 {
            color: #dc3545;
            margin-bottom: 5px;
        }

        .advantages ul, .disadvantages ul {
            margin: 5px 0;
            padding-left: 20px;
            font-size: 0.9rem;
        }

        .market-info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ UX Research Studio</h1>
            <p>AI Agent Platform –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞</p>
        </div>

        <div class="main-content">
            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è -->
            <div class="card">
                <h2>üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π</h2>
                <form id="scenarioForm">
                    <div class="form-group">
                        <label for="scenarioName">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</label>
                        <input type="text" id="scenarioName" placeholder="–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –æ—Ç–¥—ã—Ö –≤ –°–æ—á–∏" required>
                    </div>

                    <div class="form-group">
                        <label for="destination">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                        <input type="text" id="destination" placeholder="–°–æ—á–∏" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="checkIn">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</label>
                            <input type="date" id="checkIn" required>
                        </div>
                        <div class="form-group">
                            <label for="checkOut">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
                            <input type="date" id="checkOut" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="guests">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</label>
                            <select id="guests">
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5+">5+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="rooms">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</label>
                            <select id="rooms">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="stars">–ó–≤–µ–∑–¥—ã –æ—Ç–µ–ª—è</label>
                        <select id="stars">
                            <option value="–õ—é–±—ã–µ">–õ—é–±—ã–µ</option>
                            <option value="3+">3+ –∑–≤–µ–∑–¥—ã</option>
                            <option value="4+" selected>4+ –∑–≤–µ–∑–¥—ã</option>
                            <option value="5">5 –∑–≤–µ–∑–¥</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="priceLimit">–õ–∏–º–∏—Ç —Ü–µ–Ω—ã (—Ä—É–±/–Ω–æ—á—å)</label>
                        <input type="text" id="priceLimit" placeholder="10000">
                    </div>

                    <div class="form-group">
                        <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="skiStorage">
                            <label for="skiStorage">–õ—ã–∂–µ—Ö—Ä–∞–Ω–∏–ª–∏—â–µ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="transferToLift">
                            <label for="transferToLift">–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∫ –ø–æ–¥—ä–µ–º–Ω–∏–∫—É</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="freeCancellation">
                            <label for="freeCancellation">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="customPrompt">üéØ –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</label>
                        <textarea id="customPrompt" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∑–∞–¥–∞—á—É –¥–µ—Ç–∞–ª—å–Ω–æ... –ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–π—Ç–∏ –æ—Ç–µ–ª—å –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ —É –º–æ—Ä—è —Å –¥–µ—Ç—Å–∫–∏–º –∫–ª—É–±–æ–º, –±–∞—Å—Å–µ–π–Ω–æ–º –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º. –í–∞–∂–Ω–æ: –±–ª–∏–∑–∫–æ –∫ –ø–ª—è–∂—É, 4+ –∑–≤–µ–∑–¥—ã, –¥–æ 15000 —Ä—É–±/–Ω–æ—á—å"></textarea>
                        <small style="color: #666; font-size: 0.9rem;">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="competitors">üèÜ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="analyzeCompetitors">
                            <label for="analyzeCompetitors">–í–∫–ª—é—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</label>
                        </div>
                        <div id="competitorOptions" style="margin-left: 20px; display: none;">
                            <div class="checkbox-group">
                                <input type="checkbox" id="yandexTravel" value="yandex">
                                <label for="yandexTravel">–Ø–Ω–¥–µ–∫—Å.–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="bookingCom" value="booking">
                                <label for="bookingCom">Booking.com</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="hotelsCom" value="hotels">
                                <label for="hotelsCom">Hotels.com</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="expedia" value="expedia">
                                <label for="expedia">Expedia</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn" id="startBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
                </form>
            </div>

            <!-- –ß–∞—Ç —Å –∞–≥–µ–Ω—Ç–æ–º -->
            <div class="card">
                <h2>ü§ñ –ß–∞—Ç —Å AI Agent</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="chat-container" id="chatContainer">
                    <div class="message agent">
                        <div class="message-header">
                            <span>ü§ñ AI Agent</span>
                            <span id="currentTime"></span>
                        </div>
                        <div>–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å UX –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-secondary" id="stopBtn" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è -->
        <div class="card results-section hidden" id="resultsSection">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</h2>
            
            <div class="metrics-grid" id="metricsGrid">
                <!-- –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3>üö® –ü—Ä–æ–±–ª–µ–º—ã</h3>
                    <ul class="problems-list" id="problemsList">
                        <!-- –ü—Ä–æ–±–ª–µ–º—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </ul>
                </div>
                <div>
                    <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                    <ul class="recommendations-list" id="recommendationsList">
                        <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </ul>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3>üë• –§–∏–¥–±–µ–∫ –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</h3>
                <div class="personas-grid" id="personasGrid">
                    <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3>üèÜ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏</h3>
                <div class="competitive-grid" id="competitiveGrid">
                    <!-- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <h3>üìä –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç</h3>
                <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º, —Å–∫–∞—á–∞–π—Ç–µ HTML —Ñ–∞–π–ª:</p>
                <button id="downloadReportBtn" class="btn btn-primary" style="display: none;">
                    üì• –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentResearchId = null;
        let statusInterval = null;

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('scenarioForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('scenarioName').value,
                destination: document.getElementById('destination').value,
                check_in: document.getElementById('checkIn').value,
                check_out: document.getElementById('checkOut').value,
                guests: parseInt(document.getElementById('guests').value),
                rooms: parseInt(document.getElementById('rooms').value),
                stars: document.getElementById('stars').value,
                price_limit: document.getElementById('priceLimit').value,
                ski_storage: document.getElementById('skiStorage').checked,
                transfer_to_lift: document.getElementById('transferToLift').checked,
                free_cancellation: document.getElementById('freeCancellation').checked,
                custom_prompt: document.getElementById('customPrompt').value,
                analyze_competitors: document.getElementById('analyzeCompetitors').checked,
                competitors: Array.from(document.querySelectorAll('#competitorOptions input[type="checkbox"]:checked')).map(cb => cb.value)
            };

            try {
                const response = await fetch('/api/research/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                currentResearchId = data.research_id;
                
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                
                // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                startStatusPolling();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:', error);
                addMessage('‚ùå –û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ', 'error');
            }
        });

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
        document.getElementById('stopBtn').addEventListener('click', async function() {
            if (currentResearchId) {
                try {
                    await fetch(`/api/research/${currentResearchId}/stop`, {
                        method: 'POST'
                    });
                    
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    
                    if (statusInterval) {
                        clearInterval(statusInterval);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:', error);
                }
            }
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function startStatusPolling() {
            statusInterval = setInterval(async () => {
                if (!currentResearchId) return;
                
                try {
                    const response = await fetch(`/api/research/${currentResearchId}/status`);
                    const data = await response.json();
                    
                    updateProgress(data.progress);
                    updateChat(data.messages);
                    
                    if (data.status === 'completed') {
                        clearInterval(statusInterval);
                        document.getElementById('startBtn').disabled = false;
                        document.getElementById('stopBtn').disabled = true;
                        showResults(data.results);
                    } else if (data.status === 'error' || data.status === 'stopped') {
                        clearInterval(statusInterval);
                        document.getElementById('startBtn').disabled = false;
                        document.getElementById('stopBtn').disabled = true;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                }
            }, 1000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(progress) {
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞
        function updateChat(messages) {
            const container = document.getElementById('chatContainer');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.type}`;
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span>${msg.sender}</span>
                        <span>${msg.timestamp}</span>
                    </div>
                    <div>${msg.message}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function addMessage(sender, message, type = 'info') {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span>${sender}</span>
                    <span>${now.toLocaleTimeString()}</span>
                </div>
                <div>${message}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResults(results) {
            console.log('üîç –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:', results);
            console.log('üîç –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:', typeof results);
            console.log('üîç –ö–ª—é—á–∏:', Object.keys(results || {}));
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const section = document.getElementById('resultsSection');
            section.classList.remove('hidden');
            section.style.display = 'block';
            
            // –ï—Å–ª–∏ results –ø—É—Å—Ç–æ–π –∏–ª–∏ undefined, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            if (!results || Object.keys(results).length === 0) {
                section.innerHTML = `
                    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</h2>
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <p>–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
                    </div>
                `;
                return;
            }
            
            // –ú–µ—Ç—Ä–∏–∫–∏
            const metricsGrid = document.getElementById('metricsGrid');
            metricsGrid.style.display = 'grid';
            if (results.summary) {
                metricsGrid.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.overall_rating || 'N/A'}/10</div>
                        <div class="metric-label">–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.matching_hotels || 'N/A'}</div>
                        <div class="metric-label">–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö –æ—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.success_rate || 'N/A'}%</div>
                        <div class="metric-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.total_time || 'N/A'}</div>
                        <div class="metric-label">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.search_steps || 'N/A'}</div>
                        <div class="metric-label">–®–∞–≥–æ–≤ –ø–æ–∏—Å–∫–∞</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${results.summary.filters_applied || 'N/A'}</div>
                        <div class="metric-label">–ü—Ä–∏–º–µ–Ω–µ–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤</div>
                    </div>
                `;
            } else {
                metricsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</div>';
            }
            
            // –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
            console.log('üîç –ü—Ä–æ–±–ª–µ–º—ã:', results.problems);
            const problemsList = document.getElementById('problemsList');
            problemsList.style.display = 'block';
            if (results.problems && results.problems.length > 0) {
                problemsList.innerHTML = results.problems.map(problem => `
                    <li>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${problem.issue || problem.recommendation || '–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</strong>
                                <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">
                                    ${problem.rating ? `–†–µ–π—Ç–∏–Ω–≥: ${problem.rating}/10 | ` : ''}–í–ª–∏—è–Ω–∏–µ: ${problem.impact || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'} | ${problem.frequency ? `–ß–∞—Å—Ç–æ—Ç–∞: ${problem.frequency}` : `–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${problem.priority || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`}
                                </div>
                            </div>
                            <span style="background: ${(problem.impact || problem.priority) === '–í—ã—Å–æ–∫–∏–π' ? '#ff6b6b' : (problem.impact || problem.priority) === '–°—Ä–µ–¥–Ω–∏–π' ? '#ffd93d' : '#6bcf7f'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">
                                ${problem.impact || problem.priority || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                            </span>
                        </div>
                    </li>
                `).join('');
            } else {
                problemsList.innerHTML = '<li>–ü—Ä–æ–±–ª–µ–º—ã –Ω–µ –≤—ã—è–≤–ª–µ–Ω—ã</li>';
            }
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
            console.log('üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', results.recommendations);
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.style.display = 'block';
            if (results.recommendations && results.recommendations.length > 0) {
                recommendationsList.innerHTML = results.recommendations.map(rec => `
                    <li>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${rec.recommendation || '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</strong>
                                <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">
                                    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${rec.priority || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'} | –£—Å–∏–ª–∏—è: ${rec.effort || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'} | –í–ª–∏—è–Ω–∏–µ: ${rec.impact || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                                </div>
                            </div>
                            <span style="background: ${rec.priority === '–í—ã—Å–æ–∫–∏–π' ? '#ff6b6b' : rec.priority === '–°—Ä–µ–¥–Ω–∏–π' ? '#ffd93d' : '#6bcf7f'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem;">
                                ${rec.priority || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                            </span>
                        </div>
                    </li>
                `).join('');
            } else {
                recommendationsList.innerHTML = '<li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã</li>';
            }
            
            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏
            const personasGrid = document.getElementById('personasGrid');
            personasGrid.style.display = 'grid';
            if (results.personas_feedback) {
                personasGrid.innerHTML = Object.entries(results.personas_feedback).map(([key, data]) => `
                    <div class="persona-card">
                        <div class="persona-rating">${data.rating || 'N/A'}/10</div>
                        <div><strong>${key.replace('_', ' ').toUpperCase()}</strong></div>
                        <div style="margin-top: 5px; font-size: 0.9rem; color: #666;">${data.comment || '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ —É–∫–∞–∑–∞–Ω'}</div>
                        ${data.pain_points ? `
                            <div style="margin-top: 10px;">
                                <strong style="color: #ff6b6b;">–ë–æ–ª–µ–≤—ã–µ —Ç–æ—á–∫–∏:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.8rem;">
                                    ${data.pain_points.map(point => `<li>${point}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        ${data.suggestions ? `
                            <div style="margin-top: 10px;">
                                <strong style="color: #6bcf7f;">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.8rem;">
                                    ${data.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            } else {
                personasGrid.innerHTML = '<div class="persona-card">–§–∏–¥–±–µ–∫ –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            if (results.enhanced_analysis) {
                addEnhancedAnalysis(results.enhanced_analysis);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —à–∫–∞–ª—É
            if (results.timeline) {
                addTimeline(results.timeline);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è
            if (results.scenario) {
                addScenarioDetails(results.scenario);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            console.log('üîç –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑:', results.competitive_analysis);
            if (results.competitive_analysis) {
                addCompetitiveAnalysis(results.competitive_analysis);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
                const competitiveGrid = document.getElementById('competitiveGrid');
                if (competitiveGrid) {
                    competitiveGrid.style.display = 'grid';
                    competitiveGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                }
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞
            console.log('üîç –ü—É—Ç—å –∫ –ø–æ–ª–Ω–æ–º—É –æ—Ç—á–µ—Ç—É:', results.full_report_path);
            const downloadBtn = document.getElementById('downloadReportBtn');
            if (downloadBtn) {
                if (results.full_report_path) {
                    downloadBtn.style.display = 'inline-block';
                    downloadBtn.onclick = () => downloadFullReport();
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è JSON –¥–∞–Ω–Ω—ã—Ö
                    downloadBtn.style.display = 'inline-block';
                    downloadBtn.textContent = 'üì• –°–∫–∞—á–∞—Ç—å JSON –æ—Ç—á–µ—Ç';
                    downloadBtn.onclick = () => downloadJSONReport(results);
                }
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —Å—Ü–µ–Ω–∞—Ä–∏—è
        function addScenarioDetails(scenario) {
            const section = document.getElementById('resultsSection');
            
            const scenarioDetails = document.createElement('div');
            scenarioDetails.innerHTML = `
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #667eea;">
                    <h3>üéØ –î–µ—Ç–∞–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div>
                            <strong>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> ${scenario.destination || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–ó–∞–µ–∑–¥:</strong> ${scenario.check_in || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–í—ã–µ–∑–¥:</strong> ${scenario.check_out || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–ì–æ—Å—Ç–∏:</strong> ${scenario.guests || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–ö–æ–º–Ω–∞—Ç—ã:</strong> ${scenario.rooms || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–ó–≤–µ–∑–¥—ã:</strong> ${scenario.requirements?.stars || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–¶–µ–Ω–∞ –¥–æ:</strong> ${scenario.requirements?.price_limit || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div>
                            <strong>–•—Ä–∞–Ω–µ–Ω–∏–µ –ª—ã–∂:</strong> ${scenario.requirements?.ski_storage ? '–î–∞' : '–ù–µ—Ç'}
                        </div>
                        <div>
                            <strong>–¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∫ –ø–æ–¥—ä–µ–º–Ω–∏–∫—É:</strong> ${scenario.requirements?.transfer_to_lift ? '–î–∞' : '–ù–µ—Ç'}
                        </div>
                        <div>
                            <strong>–û—Ç–º–µ–Ω–∞:</strong> ${scenario.requirements?.cancellation || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                    </div>
                </div>
            `;
            section.appendChild(scenarioDetails);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        function addEnhancedAnalysis(analysis) {
            const section = document.getElementById('resultsSection');
            
            // Executive Summary
            const execSummary = document.createElement('div');
            execSummary.innerHTML = `
                <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px;">
                    <h3>üìä Executive Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                        <div>
                            <h4>–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:</h4>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${analysis.executive_summary.key_findings.map(finding => `<li>${finding}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h4>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</h4>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${analysis.executive_summary.critical_issues.map(issue => `<li>${issue}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            section.appendChild(execSummary);
            
            // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            const detailedAnalysis = document.createElement('div');
            detailedAnalysis.innerHTML = `
                <div style="margin-top: 30px;">
                    <h3>üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 15px;">
                        ${Object.entries(analysis.detailed_analysis).map(([category, data]) => `
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                                <h4 style="color: #667eea; margin-bottom: 15px;">${category.replace('_', ' ').toUpperCase()} (${data.score}/10)</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6bcf7f;">–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong>
                                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9rem;">
                                        ${data.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #ff6b6b;">–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong>
                                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9rem;">
                                        ${data.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div>
                                    <strong style="color: #667eea;">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong>
                                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9rem;">
                                        ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            section.appendChild(detailedAnalysis);
            
            // –ë–∏–∑–Ω–µ—Å-–≤–ª–∏—è–Ω–∏–µ
            const businessImpact = document.createElement('div');
            businessImpact.innerHTML = `
                <div style="margin-top: 30px; padding: 20px; background: #e8f5e8; border-radius: 10px;">
                    <h3>üíº –ë–∏–∑–Ω–µ—Å-–≤–ª–∏—è–Ω–∏–µ</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                        <div>
                            <h4>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:</h4>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${analysis.business_impact.conversion_optimization.map(impact => `<li>${impact}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:</h4>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                ${analysis.business_impact.user_experience.map(impact => `<li>${impact}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            section.appendChild(businessImpact);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã
        function addTimeline(timeline) {
            const section = document.getElementById('resultsSection');
            
            const timelineDiv = document.createElement('div');
            timelineDiv.innerHTML = `
                <div style="margin-top: 30px;">
                    <h3>‚è±Ô∏è –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                    <div style="margin-top: 15px;">
                        ${timeline.map((step, index) => `
                            <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="width: 40px; height: 40px; border-radius: 50%; background: ${step.status === 'success' ? '#6bcf7f' : step.status === 'partial' ? '#ffd93d' : '#ff6b6b'}; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">
                                    ${index + 1}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; margin-bottom: 5px;">${step.step}</div>
                                    <div style="font-size: 0.9rem; color: #666;">–í—Ä–µ–º—è: ${step.duration} —Å–µ–∫</div>
                                </div>
                                <div style="background: ${step.status === 'success' ? '#6bcf7f' : step.status === 'partial' ? '#ffd93d' : '#ff6b6b'}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem;">
                                    ${step.status === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : step.status === 'partial' ? '–ß–∞—Å—Ç–∏—á–Ω–æ' : '–û—à–∏–±–∫–∞'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            section.appendChild(timelineDiv);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        function addCompetitiveAnalysis(competitiveAnalysis) {
            const section = document.getElementById('resultsSection');
            
            const competitiveDiv = document.createElement('div');
            competitiveDiv.innerHTML = `
                <div style="margin-top: 30px;">
                    <h3>üèÜ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏</h3>
                    <div class="competitive-grid" style="margin-top: 15px;">
                        ${Object.entries(competitiveAnalysis).map(([competitor, data]) => `
                            <div class="competitor-card">
                                <div class="competitor-score">${data.score}/10</div>
                                <div class="competitor-name">${competitor.replace('_', ' ').toUpperCase()}</div>
                                
                                <div class="advantages">
                                    <h4>‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</h4>
                                    <ul>
                                        ${data.advantages.map(adv => `<li>${adv}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div class="disadvantages">
                                    <h4>‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:</h4>
                                    <ul>
                                        ${data.disadvantages.map(dis => `<li>${dis}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div class="market-info">
                                    <strong>–î–æ–ª—è —Ä—ã–Ω–∫–∞:</strong> ${data.market_share} | 
                                    <strong>–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> ${data.user_satisfaction}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            section.appendChild(competitiveDiv);
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ JSON –æ—Ç—á–µ—Ç–∞
        function downloadJSONReport(results) {
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = window.URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ux_research_report_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
        async function downloadFullReport() {
            if (!currentResearchId) {
                alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            try {
                const response = await fetch(`/api/research/${currentResearchId}/download-report`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ux_research_report_${currentResearchId}.html`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç');
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function setDefaultDates() {
            const today = new Date();
            const checkIn = new Date(today);
            checkIn.setDate(today.getDate() + 30);
            
            const checkOut = new Date(checkIn);
            checkOut.setDate(checkIn.getDate() + 7);
            
            document.getElementById('checkIn').value = checkIn.toISOString().split('T')[0];
            document.getElementById('checkOut').value = checkOut.toISOString().split('T')[0];
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏—è–º–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
        document.getElementById('analyzeCompetitors').addEventListener('change', function() {
            const competitorOptions = document.getElementById('competitorOptions');
            competitorOptions.style.display = this.checked ? 'block' : 'none';
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setDefaultDates();
    </script>
</body>
</html>
